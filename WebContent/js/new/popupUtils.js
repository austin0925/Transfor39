/**
 * popup name
 */
var CSABNKM_1ByPopup 		= 'CSABNKM_1';	//popupName = "CSABNKM_1", 金融機構檔_總行代號視窗, 顯示欄位:[總行代號,名稱]
var CSABNKM_2ByPopup 		= 'CSABNKM_2';	//popupName = "CSABNKM_2", 金融機構檔_分行代號視窗, 顯示欄位:[分行代號,名稱]
var CSACODM_1ByPopup 		= 'CSACODM_1';	//popupName = "CSACODM_1", 代碼檔視窗, 顯示欄位:[代碼,代碼意義]
var CSACODM_2ByPopup		= 'CSACODM_2';	//popupName = "CSACODM_2", 代碼檔視窗, 顯示欄位:[代碼,中文名稱,英文名稱]
var CSACODM_3ByPopup		= 'CSACODM_3';	//popupName = "CSACODM_2", 代碼檔視窗, 顯示欄位:[代碼,中文名稱]
var CSACOMM_1ByPopup		= 'CSACOMM_1';	//popupName = "CSACOMM_1", 代碼類別檔視窗, 顯示欄位:[代碼種類,代碼種類說明]
var CSACTQM_1ByPopup		= 'CSACTQM_1';	//popupName = "CSACTQM_1", 關稅配額稅則定義檔視窗, 顯示欄位:[稅則年度,稅則,額外關稅基準量代碼]
var CSACTQM_2ByPopup		= 'CSACTQM_2';	//popupName = "CSACTQM_1", 關稅配額稅則定義檔視窗, 顯示欄位:[稅則年度,稅則,額外關稅基準價代碼]
var CSAEXZM_1ByPopup		= 'CSAEXZM_1';	//popupName = "CSAEXZM_1", 查驗區檔視窗, 顯示欄位:[查驗區代號,查驗區名稱]
var CSAESZM_1ByPopup		= 'CSAESZM_1';	//popupName = "CSAESZM_1", 卸存區域代碼檔視窗, 顯示欄位:[卸存區域代號,卸存區域名稱]
var CSAWARM_1ByPopup		= 'CSAWARM_1';	//popupName = "CSAWARM_1", 卸存地檔視窗, 顯示欄位:[卸存地代號,卸存地名稱]
var CSBCOMM_1ByPopup		= 'CSBCOMM_1';	//popupName = "CSBCOMM_1", 廠商檔視窗, 顯示欄位:[營利事業統一編號,中文名稱,中文地址]
var CSBSCOM_1ByPopup		= 'CSBSCOM_1';	//popupName = "CSBSCOM_1", 船公司(代理行), 顯示欄位:[船公司(代理行)代碼,船公司名稱,船公司簡稱]
var CSECRCM_1ByPopup		= 'CSECRCM_1';	//popupName = "CSECRCM_1", 監理站視窗, 顯示欄位:[監理單位代碼,監理單位名稱]
var CSECTYM_1ByPopup		= 'CSECTYM_1';	//popupName = "CSECTYM_1", 行政執行處視窗, 顯示欄位:[區公所或鄉鎮市公所名稱,地政事務所名稱,稅捐機關名稱]
var CSBEXPM_1ByPopup		= 'CSBEXPM_1';	//popupName = "CSBEXPM_1", 快遞業者檔視窗, 顯示欄位:[快遞業者統編,快遞業者名稱]
var CSEEMPM_1ByPopup		= 'CSEEMPM_1';	//popupName = "CSEEMPM_1", 法務室承辦人員檔視窗, 顯示欄位:[員工編號,姓名]
var CSEORGM_1ByPopup		= 'CSEORGM_1';	//popupName = "CSEORGM_1", 行政執行機關檔視窗, 顯示欄位:[執行機關代碼,執行機關名稱]
var CSETOWM_1ByPopup		= 'CSETOWM_1';	//popupName = "CSETOWM_1", 地政事務所視窗, 顯示欄位:[區公所或鄉鎮市公所名稱,地政事務所名稱]
var CSETOWM_2ByPopup		= 'CSETOWM_2';	//popupName = "CSETOWM_1", 地政事務所視窗, 顯示欄位:[區公所或鄉鎮市公所名稱,稅捐機關名稱]
var CSETXNM_1ByPopup		= 'CSETXNM_1';	//popupName = "CSETXNM_1", 稅款代碼檔視窗, 顯示欄位:[欠繳稅款代號,執行機關名稱]
var CSEUNTM_1ByPopup		= 'CSEUNTM_1';	//popupName = "CSEUNTM_1", 移案單位代碼檔視窗, 顯示欄位:[移案單位代號,移案單位名稱]
var RMJTRKM_1ByPopup        = 'RMJTRKM_1';	//popupName = "RMJTRKM_1", 員工查詢視窗, 顯示欄位:[註冊號數]
var RMJX10M_1ByPopup        = 'RMJX10M_1';	//popupName = "RMJX10M_1", 舊違規貨品種類代碼參考表(民國101年以前), 顯示欄位:[代碼,代碼意義]
var RMLX05M_1ByPopup		= 'RMLX05M_1';	//popupName = "RMLX05M_1", 高風險廠商類別檔視窗, 顯示欄位:[類別代號,類別名稱]
var RMLZ01M_1ByPopup		= 'RMLZ01M_1';	//popupName = "RMLZ01M_1", 查詢項目代碼檔, 顯示欄位:[查詢代號,查詢名稱]
var RMPUSRM_1ByPopup		= 'RMPUSRM_1';	//popupName = "RMPUSRM_1", 稽核人員代碼查詢視窗, 顯示欄位:[稽核員編號,稽核員姓名]
var RMQACCM_1ByPopup		= 'RMQACCM_1';	//popupName = "RMQACCM_1", '帳目代號檔視窗, 顯示欄位:[帳目代號,帳目名稱]
var RMQCASM_1ByPopup		= 'RMQCASM_1';	//popupName = "RMQCASM_1", '案由檔視窗, 顯示欄位:[案由代號,案由名稱,案由內容]
var RMQCHGM_1ByPopup		= 'RMQCHGM_1';	//popupName = "RMQCHGM_1", '欠繳類別代碼資料查詢, 顯示欄位:[欠繳項目代碼,欠繳項目名稱]
var RMQJOBM_1ByPopup		= 'RMQJOBM_1';	//popupName = "RMQJOBM_1", 緝案組工作項目檔視窗, 顯示欄位:[工作項目名稱]
var RMQLAWM_1ByPopup		= 'RMQLAWM_1';	//popupName = "RMQLAWM_1", 法令代碼檔視窗, 顯示欄位:[法令代碼,法令名稱]
var RMQLIMM_1ByPopup		= 'RMQLIMM_1';	//popupName = "RMQLIMM", 私貨處理限制條件查詢視窗, 顯示欄位:[限制條件編號,限制條件內容]
var RMQPBRM_1ByPopup		= 'RMQPBRM_1';	//popupName = "RMQPBRM_1", 安康專案菸類牌名檔視窗, 顯示欄位:[項次,菸類牌名]
var RMQPGDM_1ByPopup		= 'RMQPGDM_1';	//popupName = "RMQPGDM_1", 安康專案查緝走私產品類別檔視窗, 顯示欄位:[代碼,代碼名稱,單位]
var RMQPGDM_2ByPopup		= 'RMQPGDM_2';	//popupName = "RMQPGDM_2", 安康專案查緝走私產品類別檔視窗, 顯示欄位:[代碼,代碼名稱,單位], 只取得當 PGD_CD 長度為2
var RMQSFUM_1ByPopup		= 'RMQSFUM_1';	//popupName = "RMQSFUM_1", 速查視窗, 顯示欄位:[一級單位代碼, 一級單位名稱]
var RMQSMGM_1ByPopup		= 'RMQSMGM_1';	//popupName = "RMQSMGM_1", 私貨代碼檔視窗, 顯示欄位:[私貨代碼,私貨中文貨名]
var RMQSMGM_2ByPopup		= 'RMQSMGM_2';	//popupName = "RMQSMGM_2", 私貨代碼檔視窗, 顯示欄位:[私貨代碼,私貨中文貨名,中文單位,英文單位]
var RMQSOUM_1ByPopup		= 'RMQSOUM_1';	//popupName = "RMQSOUM_1", 緝案處理單位檔視窗, 顯示欄位:[緝案處理單位,處理單位名稱]
var RMQSR1D_1ByPopup		= 'RMQSR1D_1';	//popupName = "RMQSR1D_1", 身分證或廠商統編, 顯示欄位:[身分證或廠商統編,名稱]
var RMQSR2D_1ByPopup		= 'RMQSR2D_1';	//popupName = "RMQSR2D_1", 速查視窗, 顯示欄位:[項次]
var RMQSR7D_1ByPopup		= 'RMQSR7D_1';	//popupName = "RMQSR7D_1", 出力人員檔視窗, 顯示欄位:[員工編號,員工姓名]
var RMQSRMM_1ByPopup		= 'RMQSRMM_1';	//popupName = "RMQSRMM_1", 緝私報告主檔視窗, 顯示欄位:[緝獲單位編號,'緝私案號]
var RMQSRNM_1ByPopup		= 'RMQSRNM_1';	//popupName = "RMQSRNM_1", 緝獲單位編號字碼檔視窗, 顯示欄位:[關別,緝獲單位編號字碼]
var RMQSRNM_2ByPopup 		= 'RMQSRNM_2';	//popupName = "RMQSRNM_2", 緝獲單位編號字碼檔視窗, 顯示欄位:[緝獲單位編號字碼]
var RMQSUNM_1ByPopup 		= 'RMQSUNM_1';	//popupName = "RMQSUNM_1", 緝獲單位代碼檔視窗, 顯示欄位:[緝獲單位代碼,緝獲單位]
var RMQSUNM_2ByPopup 		= 'RMQSUNM_2';	//popupName = "RMQSUNM_2", 緝獲單位代碼檔視窗, 顯示欄位:[緝獲單位代碼,緝獲單位]
var RMQSWCM_1ByPopup		= 'RMQSWCM_1';	//popupName = "RMQSWCM_1", 走私方式檔視窗, 顯示欄位:[走私方式代碼,走私方式]
var RMQSYCD_1ByPopup		= 'RMQSYCD_1';	//popupName = "RMQSYCD_1", 查緝系統代碼檔視窗, 顯示欄位:[類別/縣市別,天數]
var RMQSYCD_2ByPopup		= 'RMQSYCD_2';	//popupName = "RMQSYCD_2", 查緝系統代碼檔視窗, 顯示欄位:[代碼意義]
var RMQSYCD_3ByPopup		= 'RMQSYCD_3';	//popupName = "RMQSYCD_3", 查緝系統代碼檔視窗, 顯示欄位:[代碼,代碼意義]
var RMQSYCD_4ByPopup		= 'RMQSYCD_4';	//popupName = "RMQSYCD_4", 私貨處理_放行通知單格式視窗, 顯示欄位:[放行通知單格式]
var RMQSYCD_5ByPopup		= 'RMQSYCD_5';	//popupName = "RMQSYCD_5", 私貨處理_銷毀清單(文號)格式視窗, 顯示欄位:[銷毀清單(文號)格式]
var RMQSZLM_1ByPopup		= 'RMQSZLM_1';	//popupName = "RMQSZLM_1", 緝獲地點代碼檔視窗, 顯示欄位:[緝獲地點代碼,緝獲地點]
var RMQUNTM_1ByPopup		= 'RMQUNTM_1';	//popupName = "RMQUNTM_1", 各級單位速查視窗, 顯示欄位:[各級單位名稱]
var SCKNDMM_1ByPopup		= 'SCKNDMM_1';	//popupName = "SCKNDMM_1", 代碼種類檔視窗, 顯示欄位:[代碼種類,代碼種類說明,新代碼類別(關港貿)]
var V02A_1ByPopup		    = 'V02A_1';     //popupName = "V02A_1", 員工查詢視窗, 顯示欄位:[員工編號, 員工姓名]
var VW_GCVIEW1_1ByPopup		= 'VW_GCVIEW1_1'; //popupName = "VW_GCVIEW1_1", 違規整合作業之部門清單視窗, 顯示欄位:[代碼,中文名稱]
var VW_ORG_4RJ_1ByPopup		= 'VW_ORG_4RJ_1'; //popupName = "VW_ORG_4RJ_OLD_1", 關別查詢視窗, 顯示欄位:[代碼,代碼意義]
var VW_ORG_4RJ_OLD_1ByPopup	= 'VW_ORG_4RJ_OLD_1'; //popupName = "VW_ORG_4RJ_1", 關別查詢視窗, 顯示欄位:[代碼,代碼意義]
var VW_PERSON_LIST_1ByPopup	= 'VW_PERSON_LIST_1';//popupName = "VW_PERSON_LIST_1", 海關關員人員視窗, 顯示欄位:[代號, 姓名, 部門, 部門名稱]
var VW_RMQSR6D_1ByPopup		= 'VW_RMQSR6D_1'; //popupName = "VW_RMQSR6D_1", 法令受處分人資料檔視窗, 顯示欄位:[身分證或廠商統編,名稱]
var WFCODNM_1ByPopup		= 'WFCODNM_1';	//popupName = "WFCODNM_1", 簡易申辦代碼資料視窗, 顯示欄位:[代碼,代碼意義]
var WFORGNM_1ByPopup		= 'WFORGNM_1';	//popupName = "WFORGNM_1", 表單組織資料視窗, 顯示欄位:[單位代碼,單位中文名稱] 
var NFSSTOM_1ByPopup		= 'NFSSTOM_1';	//popupName = "NFSSTOM_1", 國際免稅商店業者視窗, 顯示欄位:[免稅商店,廠商名稱] 
var SAAB_APPLICATION_1ByPopup	 = 'SAAB_APPLICATION_1';	//popupName = "SAAB_APPLICATION_1", 應用系統代碼速查視窗, 顯示欄位:[應用系統代碼,系統名稱]
var SAAB_PRIVILEGE_DATA_1ByPopup = 'SAAB_PRIVILEGE_DATA_1';	//popupName = "SAAB_PRIVILEGE_DATA_1", 稽核項目速查視窗, 顯示欄位:[權限項目代碼,權限項目名稱]
var SAAB_PRIVILEGE_DATA_2ByPopup = 'SAAB_PRIVILEGE_DATA_2';	//popupName = "SAAB_PRIVILEGE_DATA_2", 稽核項目速查視窗, 顯示欄位:[權限項目代碼,權限項目名稱]
var SAAB_ORG_DATA_1ByPopup       = 'SAAB_ORG_DATA_1';		//popupName = "SAAB_ORG_DATA_1", 部門單位查詢視窗, 顯示欄位:[部門代碼,部門名稱]
var SAAB_USER_DATA_1ByPopup      = 'SAAB_USER_DATA_1';		//popupName = "SAAB_USER_DATA_1", 使用者資料速查視窗, 顯示欄位:[使用者帳號,使用者名稱]

var globalSettings = null;

( function( $ ){
	$.fn.popup = function( settings ){
		var defaultSettings = { 
			popupName		: null,		// a popname, 其值請參考	popup name		
			qryCodeEle		: null,		// 將欄位值返回快取視窗查詢設定
			codeEle			: null,		// 填入 code selector, 如果不需要填入, 不用設定
			nameEle			: null,		// 填入 name selector, 如果不需要填入, 不用設定
			dynamicCode		: null,		// 填入 code selector, 如果不需要填入, 不用設定, 動態產生使用
			dynamicName		: null,		// 填入 code selector, 如果不需要填入, 不用設定, 動態產生使用
			strWhereEle		: null,		// conditions 的 selector,SQL將以 X  欄位 in (strWhere)帶入
			show			: true,		// 跳出的視窗, 是否要顯示查詢欄位
			qryTitle		: 0,		// 主要查詢欄位Title
			qryAllFiled		: true,
			popupTitle		: 'PopupTitle',//popup title			
			debug			: false,			
			doBeforeSetting	: function(){},	//在 popup framework 讀取 settings, ex: strWhereEle, qryTitle
			doBefore		: function(){ return true; } , //開啟視窗前要做的事, 如果 return false, 將不開啟視窗
			callback		: function( data ){},//popup title	
			eventType		: 'dblclick'
		};

		var newSettings = $.extend( defaultSettings, settings );
		
		if(newSettings.eventType == 'click'){
			$( document ).on( 'click', this.selector, dblclickByPopup( newSettings ) );
		}else{
			$( document ).on( 'dblclick', this.selector, dblclickByPopup( newSettings ) );
		}
		
		
		return this;
	};
} )( jQuery );

function checkSettingsByPopup( newSettings ){
	if( newSettings.popupName == null ){
		alert( '使用 popup 錯誤, 尚未設定 popupName, 請指定一個' );
		return false;
	}
	
	if( !( 	
			newSettings.popupName == CSABNKM_1ByPopup ||
			newSettings.popupName == CSABNKM_2ByPopup ||
			newSettings.popupName == CSACODM_1ByPopup ||
			newSettings.popupName == CSACODM_2ByPopup ||
			newSettings.popupName == CSACODM_3ByPopup ||
			newSettings.popupName == CSACOMM_1ByPopup ||
			newSettings.popupName == CSACTQM_1ByPopup ||
			newSettings.popupName == CSACTQM_2ByPopup ||
			newSettings.popupName == CSAEXZM_1ByPopup ||
			newSettings.popupName == CSAESZM_1ByPopup ||
			newSettings.popupName == CSAWARM_1ByPopup ||
			newSettings.popupName == CSBCOMM_1ByPopup ||
			newSettings.popupName == CSBSCOM_1ByPopup ||
			newSettings.popupName == CSECRCM_1ByPopup ||
			newSettings.popupName == CSECTYM_1ByPopup ||
			newSettings.popupName == CSBEXPM_1ByPopup ||
			newSettings.popupName == CSEEMPM_1ByPopup ||
			newSettings.popupName == CSEORGM_1ByPopup ||
			newSettings.popupName == CSETOWM_1ByPopup ||
			newSettings.popupName == CSETOWM_2ByPopup ||
			newSettings.popupName == CSETXNM_1ByPopup ||
			newSettings.popupName == CSEUNTM_1ByPopup ||
			newSettings.popupName == RMJTRKM_1ByPopup ||
			newSettings.popupName == RMJX10M_1ByPopup ||
			newSettings.popupName == RMLX05M_1ByPopup ||
			newSettings.popupName == RMLZ01M_1ByPopup ||
			newSettings.popupName == RMPUSRM_1ByPopup ||
			newSettings.popupName == RMQACCM_1ByPopup ||
			newSettings.popupName == RMQCASM_1ByPopup ||
			newSettings.popupName == RMQCHGM_1ByPopup ||
			newSettings.popupName == RMQJOBM_1ByPopup ||
			newSettings.popupName == RMQLAWM_1ByPopup ||
			newSettings.popupName == RMQLIMM_1ByPopup ||
			newSettings.popupName == RMQPBRM_1ByPopup ||
			newSettings.popupName == RMQPGDM_1ByPopup ||
			newSettings.popupName == RMQPGDM_2ByPopup ||
			newSettings.popupName == RMQSFUM_1ByPopup ||
			newSettings.popupName == RMQSMGM_1ByPopup ||
			newSettings.popupName == RMQSMGM_2ByPopup ||
			newSettings.popupName == RMQSOUM_1ByPopup ||
			newSettings.popupName == RMQSR1D_1ByPopup ||
			newSettings.popupName == RMQSR2D_1ByPopup ||
			newSettings.popupName == RMQSR7D_1ByPopup ||
			newSettings.popupName == RMQSRMM_1ByPopup ||
			newSettings.popupName == RMQSRNM_1ByPopup ||
			newSettings.popupName == RMQSRNM_2ByPopup ||
			newSettings.popupName == RMQSUNM_1ByPopup ||
			newSettings.popupName == RMQSUNM_2ByPopup ||
			newSettings.popupName == RMQSWCM_1ByPopup || 
			newSettings.popupName == RMQSYCD_1ByPopup ||
			newSettings.popupName == RMQSYCD_2ByPopup ||
			newSettings.popupName == RMQSYCD_3ByPopup ||
			newSettings.popupName == RMQSYCD_4ByPopup ||
			newSettings.popupName == RMQSYCD_5ByPopup ||
			newSettings.popupName == RMQSZLM_1ByPopup ||
			newSettings.popupName == RMQUNTM_1ByPopup ||
			newSettings.popupName == SCKNDMM_1ByPopup ||
			newSettings.popupName == V02A_1ByPopup||
			newSettings.popupName == VW_GCVIEW1_1ByPopup||
			newSettings.popupName == VW_ORG_4RJ_1ByPopup||
			newSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup||
			newSettings.popupName == VW_PERSON_LIST_1ByPopup||
			newSettings.popupName == VW_RMQSR6D_1ByPopup||
			newSettings.popupName == WFCODNM_1ByPopup ||
			newSettings.popupName == WFORGNM_1ByPopup ||
			newSettings.popupName == NFSSTOM_1ByPopup ||
			newSettings.popupName == SAAB_APPLICATION_1ByPopup ||
			newSettings.popupName == SAAB_PRIVILEGE_DATA_1ByPopup ||
			newSettings.popupName == SAAB_PRIVILEGE_DATA_2ByPopup ||
			newSettings.popupName == SAAB_ORG_DATA_1ByPopup ||
			newSettings.popupName == SAAB_USER_DATA_1ByPopup 
			)){
		alert( '使用 popup 錯誤, popupName 值指定錯誤, 找不到 popupName:' + newSettings.popupName );
		return false;
	}
	
	if( !checkSelector( newSettings ) )
		return false;
	
	if( !checkTypeByPopup( newSettings ) )
		return false;
	
	if( !checkMustSetting( newSettings ) )
		return false;
	
	return true;
}	

/**
 * 檢查 select 有宣告, 但找不到 selector
 * @param newSettings
 * @returns {Boolean}
 */
function checkSelector( newSettings ){
	if( newSettings.codeEle != null && newSettings.codeEle.length == 0 ){
		alert( '使用 popup 錯誤, 指定的  codeEle 找不到 selector' );
		return false;
	}
	
	if( newSettings.nameEle != null && newSettings.nameEle.length == 0 ){
		alert( '使用 popup 錯誤, 指定的  nameEle 找不到 selector' );
		return false;
	}
	
	if( newSettings.strWhereEle != null && newSettings.strWhereEle.length == 0 ){
		alert( '使用 popup 錯誤, 指定的  strWhereEle 找不到 selector' );
		return false;
	}
	
	return true;
}

/**
 * 檢查宣告的型能有沒有錯誤
 * 
 * @param newSettings
 * @returns {Boolean}
 */
function checkTypeByPopup( newSettings ){
	if( newSettings.show == null || typeof( newSettings.show ) != 'boolean' ){
		alert( '使用 popup 錯誤, 指定的  show 值錯誤, 只能使用 true 或 false boolean 型態' );
		return false;
	}	
	
	if( newSettings.qryTitle == null || typeof( newSettings.qryTitle ) != 'number' ){
		alert( '使用 popup 錯誤, 指定的  qryTitle 值錯誤, 只能使用 typeof( newSettings.qryTitle ) 型態' );
		return false;
	}
	
	if( newSettings.debug == null || typeof( newSettings.debug ) != 'boolean' ){
		alert( '使用 popup 錯誤, 指定的  debug 值錯誤, 只能使用 true 或 false boolean 型態' );
		return false;
	}
	
	return true;
}

/**
 * 檢查當某些 popname, 需要有設定
 * 
 * @param newSettings
 */
function checkMustSetting( newSettings ){
	if( 
		newSettings.popupName == CSACODM_1ByPopup ||
		newSettings.popupName == CSACODM_2ByPopup ||
		newSettings.popupName == RMQSYCD_3ByPopup ||
		newSettings.popupName == WFCODNM_1ByPopup ||
		newSettings.popupName == VW_ORG_4RJ_1ByPopup||
		newSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup||
		newSettings.popupName == RMPUSRM_1ByPopup)

		if( newSettings.strWhereEle == null || newSettings.strWhereEle.length == 0 || $.trim( newSettings.strWhereEle.val() ) == '' ){
			alert( '使用 popup 錯誤, 當  popname=' + newSettings.popupName + ', 必需指定 strWhereEle' );
			
			return false;
		}
		
	return true;	
}

function dblclickByPopup( newSettings ){
	return function(){
		
		if( !checkSettingsByPopup( newSettings ) )
			return;
		
		newSettings.doBeforeSetting();
		
		var id = $(this).attr( 'id' );
		
		globalSettings = newSettings; 
		globalSettings.id = id;
		
		if( globalSettings.debug )
			alert( 'run dblclick, id:' + id );
		
		var fieldTitle =  getFieldTitle();
		var settingIdName = getSettingIdName();
		var strWhere = getStrWhere();
		
		if( globalSettings.debug )
			alert( 'in dblclickByPopup, settingIdName:' + settingIdName );
		
		var strParam = 'fieldTitle=' + fieldTitle;
		
		if( globalSettings.qryCodeEle != null )
			strParam += ( '&qryCode=' + globalSettings.qryCodeEle.val() );
		
		if( strWhere != null )
			strParam += ( '&strWhere=' + strWhere );
		
		strParam += ( '&qryTitle=' + globalSettings.qryTitle ); 
		strParam += ( '&show=' + globalSettings.show ); 
		strParam += ( '&qryAllFiled=' + globalSettings.qryAllFiled ); 
		var url = getContextPath() + '/TablePopUp_' + settingIdName + '!queryPopUp?' + strParam;
		
		if( globalSettings.debug )
			alert( 'in dblclickByPopup() function, url:' + url );
		

		if( !newSettings.doBefore() )
			return ;
		
		popupTitleSetting( newSettings ); 
		 
		openMediumWindowByUrl( url, true, newSettings.popupTitle );
		 
		
	};
}


function getFieldTitle(){
	if( globalSettings.debug )
		alert( 'in the getFieldTitle, popupName:' + globalSettings.popupName );
	
	var fieldTitle = null;
	
	if( globalSettings.popupName == CSABNKM_1ByPopup )
		fieldTitle = encodeURI( '總行代號,名稱' );
	else if( globalSettings.popupName == CSABNKM_2ByPopup )
		fieldTitle = encodeURI( '分行代號,名稱' );
	else if( globalSettings.popupName == CSACODM_1ByPopup )
		fieldTitle = encodeURI( '代碼,代碼意義' );
	else if( globalSettings.popupName == CSACODM_2ByPopup )
		fieldTitle = encodeURI( '代碼,中文名稱,英文名稱' );
	else if( globalSettings.popupName == CSACODM_3ByPopup )
		fieldTitle = encodeURI( '代碼,中文名稱' );
	else if( globalSettings.popupName == CSACOMM_1ByPopup )
		fieldTitle = encodeURI( '代碼種類,代碼種類說明' );
	else if( globalSettings.popupName == CSACTQM_1ByPopup )
		fieldTitle = encodeURI( '稅則年度,稅則,額外關稅基準量代碼' );
	else if( globalSettings.popupName == CSACTQM_2ByPopup )
		fieldTitle = encodeURI( '稅則年度,稅則,額外關稅基準價代碼' );
	else if( globalSettings.popupName == CSAEXZM_1ByPopup )
		fieldTitle = encodeURI( '查驗區代號,查驗區名稱' );
	else if( globalSettings.popupName == CSAESZM_1ByPopup )
		fieldTitle = encodeURI( '卸存區域代號,卸存區域名稱' );
	else if( globalSettings.popupName == CSAWARM_1ByPopup )
		fieldTitle = encodeURI( '卸存地代號,卸存地名稱' );
	else if( globalSettings.popupName == CSBCOMM_1ByPopup )
		fieldTitle = encodeURI( '營利事業統一編號,中文名稱,中文地址' );	
	else if( globalSettings.popupName == CSBSCOM_1ByPopup )
		fieldTitle = encodeURI( '船公司(代理行)代碼,船公司名稱,船公司簡稱' );	
	else if( globalSettings.popupName == CSECRCM_1ByPopup )
		fieldTitle = encodeURI( '[監理單位代碼,監理單位名稱' );	
	else if( globalSettings.popupName == CSECTYM_1ByPopup )
		fieldTitle = encodeURI( '縣市代碼,縣市名稱,隸屬行政執行分署名稱' );
	else if( globalSettings.popupName == CSBEXPM_1ByPopup )
		fieldTitle = encodeURI( '快遞業者統編,快遞業者名稱' );
	else if( globalSettings.popupName == CSEEMPM_1ByPopup )
		fieldTitle = encodeURI( '員工編號,姓名' );
	else if( globalSettings.popupName == CSEORGM_1ByPopup )
		fieldTitle = encodeURI( '執行機關代碼,執行機關名稱' );
	else if( globalSettings.popupName == CSETOWM_1ByPopup )
		fieldTitle = encodeURI( '區公所或鄉鎮市公所名稱,地政事務所名稱' );
	else if( globalSettings.popupName == CSETOWM_2ByPopup )
		fieldTitle = encodeURI( '區公所或鄉鎮市公所名稱,稅捐機關名稱' );
	else if( globalSettings.popupName == CSETXNM_1ByPopup )
		fieldTitle = encodeURI( '欠繳稅款代號,欠繳稅款款項名稱' );
	else if( globalSettings.popupName == CSEUNTM_1ByPopup )
		fieldTitle = encodeURI( '移案單位代號,移案單位名稱' );
	else if( globalSettings.popupName == RMJTRKM_1ByPopup )
		fieldTitle = encodeURI( '註冊號數' );
	else if( globalSettings.popupName == RMJX10M_1ByPopup )
		fieldTitle = encodeURI( '代碼,代碼意義' );
	else if( globalSettings.popupName == RMLX05M_1ByPopup )
		fieldTitle = encodeURI( '類別代號,類別名稱' );
	else if( globalSettings.popupName == RMLZ01M_1ByPopup )
		fieldTitle = encodeURI( '查詢代號,查詢名稱' );
	else if( globalSettings.popupName == RMPUSRM_1ByPopup )
		fieldTitle = encodeURI( '稽核員編號,稽核員姓名,協辦稽核員編號,協辦稽核員姓名' );
	else if( globalSettings.popupName == RMQACCM_1ByPopup )
		fieldTitle = encodeURI( '帳目代號,帳目名稱' );
	else if( globalSettings.popupName == RMQCASM_1ByPopup )
		fieldTitle = encodeURI( '案由代號,案由名稱,案由內容' );
	else if( globalSettings.popupName == RMQCHGM_1ByPopup )
		fieldTitle = encodeURI( '欠繳項目代碼,欠繳項目名稱' );
	else if( globalSettings.popupName == RMQJOBM_1ByPopup )
		fieldTitle = encodeURI( '工作項目名稱' );
	else if( globalSettings.popupName == RMQLAWM_1ByPopup )
		fieldTitle = encodeURI( '法令代碼,法令名稱' );
	else if( globalSettings.popupName == RMQLIMM_1ByPopup )
		fieldTitle = encodeURI( '限制條件編號,限制條件內容' );
	else if( globalSettings.popupName == RMQPBRM_1ByPopup )
		fieldTitle = encodeURI( '項次,菸類牌名' );
	else if( globalSettings.popupName == RMQPGDM_1ByPopup )
		fieldTitle = encodeURI( '代碼,代碼名稱,單位' );
	else if( globalSettings.popupName == RMQPGDM_2ByPopup )
		fieldTitle = encodeURI( '代碼,代碼名稱,單位' );
	else if( globalSettings.popupName == RMQSFUM_1ByPopup )
		fieldTitle = encodeURI( '一級單位代碼,一級單位名稱' );
	else if( globalSettings.popupName == RMQSMGM_1ByPopup )
		fieldTitle = encodeURI( '私貨代碼,私貨中文貨名' );
	else if( globalSettings.popupName == RMQSMGM_2ByPopup )
		fieldTitle = encodeURI( '私貨代碼,私貨中文貨名,中文單位,英文單位' );
	else if( globalSettings.popupName == RMQSOUM_1ByPopup )
		fieldTitle = encodeURI( '緝案處理單位,處理單位名稱' );
	else if( globalSettings.popupName == RMQSR1D_1ByPopup )
		fieldTitle = encodeURI( '身分證或廠商統編,名稱' );
	else if( globalSettings.popupName == RMQSR2D_1ByPopup )
		fieldTitle = encodeURI( '項次' );
	else if( globalSettings.popupName == RMQSR7D_1ByPopup )
		fieldTitle = encodeURI( '員工編號,員工姓名' );
	else if( globalSettings.popupName == RMQSRMM_1ByPopup )
		fieldTitle = encodeURI( '緝獲單位編號,緝私案號' );
	else if( globalSettings.popupName == RMQSRNM_1ByPopup )
		fieldTitle = encodeURI( '關別,緝獲單位編號字碼' );
	else if( globalSettings.popupName == RMQSRNM_2ByPopup )
		fieldTitle = encodeURI( '緝獲單位編號字碼' );
	else if( globalSettings.popupName == RMQSUNM_1ByPopup || globalSettings.popupName == RMQSUNM_2ByPopup)
		fieldTitle = encodeURI( '緝獲單位代碼,緝獲單位' );
	else if( globalSettings.popupName == RMQSWCM_1ByPopup )
		fieldTitle = encodeURI( '走私方式代碼,走私方式' );
	else if( globalSettings.popupName == RMQSYCD_1ByPopup )
		fieldTitle = encodeURI( '類別/縣市別,天數' );
	else if( globalSettings.popupName == RMQSYCD_2ByPopup )
		fieldTitle = encodeURI( '代碼意義' );
	else if( globalSettings.popupName == RMQSYCD_3ByPopup )
		fieldTitle = encodeURI( '代碼,代碼意義' );
	else if( globalSettings.popupName == RMQSYCD_4ByPopup )
		fieldTitle = encodeURI( '放行通知單格式' );
	else if( globalSettings.popupName == RMQSYCD_5ByPopup )
		fieldTitle = encodeURI( '銷毀清單(文號)格式' );
	else if( globalSettings.popupName == RMQSZLM_1ByPopup )
		fieldTitle = encodeURI( '緝獲地點代碼,緝獲地點' );
	else if( globalSettings.popupName == RMQUNTM_1ByPopup )
		fieldTitle = encodeURI( '各級單位名稱' );
	else if( globalSettings.popupName == SCKNDMM_1ByPopup )
		fieldTitle = encodeURI( '代碼種類,代碼種類說明,新代碼類別(關港貿)' );
	else if( globalSettings.popupName == V02A_1ByPopup )
		fieldTitle = encodeURI( '員工編號,員工姓名' );
	else if( globalSettings.popupName == VW_GCVIEW1_1ByPopup )
		fieldTitle = encodeURI( '代碼,中文名稱' );
	else if( globalSettings.popupName == VW_ORG_4RJ_1ByPopup || globalSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup )
		fieldTitle = encodeURI( '一級單位代碼,一級單位名稱' );
	else if( globalSettings.popupName == VW_PERSON_LIST_1ByPopup )
		fieldTitle = encodeURI( '代號, 姓名, 部門, 部門名稱' );
	else if( globalSettings.popupName == VW_RMQSR6D_1ByPopup )
		fieldTitle = encodeURI( '身分證或廠商統編,名稱' );
	else if( globalSettings.popupName == WFCODNM_1ByPopup )
		fieldTitle = encodeURI( '代碼,代碼意義' );
	else if( globalSettings.popupName == WFORGNM_1ByPopup )
		fieldTitle = encodeURI( '單位代碼,單位中文名稱' );
	else if( globalSettings.popupName == NFSSTOM_1ByPopup )
		fieldTitle = encodeURI( '免稅商店,廠商名稱' );
	else if( globalSettings.popupName == SAAB_APPLICATION_1ByPopup )
		fieldTitle = encodeURI( '應用系統代碼,應用系統名稱' );
	else if( globalSettings.popupName == SAAB_PRIVILEGE_DATA_1ByPopup || globalSettings.popupName == SAAB_PRIVILEGE_DATA_2ByPopup)
		fieldTitle = encodeURI( '權限項目代碼,權限項目名稱' );
	else if( globalSettings.popupName == SAAB_ORG_DATA_1ByPopup )
		fieldTitle = encodeURI( '部門代碼,部門名稱' );
	else if( globalSettings.popupName == SAAB_USER_DATA_1ByPopup )
		fieldTitle = encodeURI( '使用者帳號,使用者名稱' );
	
	if( fieldTitle == null )
		alert( 'Can not find any field title in getFieldTitle() function, when popupName:' + globalSettings.popupName );
	
	return fieldTitle;
}

function getSettingIdName(){
	if( globalSettings.debug )
		alert( 'in the getSettingIdName, popupName:' + globalSettings.popupName );
	
	var settingIdName = null;
	
	if( globalSettings.popupName == CSABNKM_1ByPopup )
		settingIdName = 'CSABNKM_1';
	else if( globalSettings.popupName == CSABNKM_2ByPopup )
		settingIdName = 'CSABNKM_2';
	else if( globalSettings.popupName == CSACODM_1ByPopup )
		settingIdName = 'CSACODM_1';
	else if( globalSettings.popupName == CSACODM_2ByPopup )
		settingIdName = 'CSACODM_2';
	else if( globalSettings.popupName == CSACODM_3ByPopup )
		settingIdName = 'CSACODM_3';
	else if( globalSettings.popupName == CSACOMM_1ByPopup )
		settingIdName = 'CSACOMM_1';
	else if( globalSettings.popupName == CSACTQM_1ByPopup )
		settingIdName = 'CSACTQM_1';
	else if( globalSettings.popupName == CSACTQM_2ByPopup )
		settingIdName = 'CSACTQM_2';
	else if( globalSettings.popupName == CSAEXZM_1ByPopup )
		settingIdName = 'CSAEXZM_1';
	else if( globalSettings.popupName == CSAESZM_1ByPopup )
		settingIdName = 'CSAESZM_1';
	else if( globalSettings.popupName == CSAWARM_1ByPopup )
		settingIdName = 'CSAWARM_1';
	else if( globalSettings.popupName == CSBCOMM_1ByPopup )
		settingIdName = 'CSBCOMM_1';
	else if( globalSettings.popupName == CSBSCOM_1ByPopup )
		settingIdName = 'CSBSCOM_1';
	else if( globalSettings.popupName == CSECRCM_1ByPopup )
		settingIdName = 'CSECRCM_1';
	else if( globalSettings.popupName == CSECTYM_1ByPopup )
		settingIdName = 'CSECTYM_1';
	else if( globalSettings.popupName == CSBEXPM_1ByPopup )
		settingIdName = 'CSBEXPM_1';
	else if( globalSettings.popupName == CSEEMPM_1ByPopup )
		settingIdName = 'CSEEMPM_1';
	else if( globalSettings.popupName == CSEORGM_1ByPopup )
		settingIdName = 'CSEORGM_1';
	else if( globalSettings.popupName == CSETOWM_1ByPopup )
		settingIdName = 'CSETOWM_1';
	else if( globalSettings.popupName == CSETOWM_2ByPopup )
		settingIdName = 'CSETOWM_2';
	else if( globalSettings.popupName == CSETXNM_1ByPopup )
		settingIdName = 'CSETXNM_1';
	else if( globalSettings.popupName == CSEUNTM_1ByPopup )
		settingIdName = 'CSEUNTM_1';
	else if( globalSettings.popupName == RMJTRKM_1ByPopup )
		settingIdName = 'RMJTRKM_1';
	else if( globalSettings.popupName == RMJX10M_1ByPopup )
		settingIdName = 'RMJX10M_1';
	else if( globalSettings.popupName == RMLX05M_1ByPopup )
		settingIdName = 'RMLX05M_1';
	else if( globalSettings.popupName == RMLZ01M_1ByPopup )
		settingIdName = 'RMLZ01M_1';
	else if( globalSettings.popupName == RMPUSRM_1ByPopup )
		settingIdName = 'RMPUSRM_1';
	else if( globalSettings.popupName == RMQACCM_1ByPopup )
		settingIdName = 'RMQACCM_1';
	else if( globalSettings.popupName == RMQCASM_1ByPopup )
		settingIdName = 'RMQCASM_1';
	else if( globalSettings.popupName == RMQCHGM_1ByPopup )
		settingIdName = 'RMQCHGM_1';
	else if( globalSettings.popupName == RMQJOBM_1ByPopup )
		settingIdName = 'RMQJOBM_1';
	else if( globalSettings.popupName == RMQLAWM_1ByPopup )
		settingIdName = 'RMQLAWM_1';
	else if( globalSettings.popupName == RMQLIMM_1ByPopup )
		settingIdName = 'RMQLIMM_1';
	else if( globalSettings.popupName == RMQPBRM_1ByPopup )
		settingIdName = 'RMQPBRM_1';
	else if( globalSettings.popupName == RMQPGDM_1ByPopup )
		settingIdName = 'RMQPGDM_1';
	else if( globalSettings.popupName == RMQPGDM_2ByPopup )
		settingIdName = 'RMQPGDM_2';
	else if( globalSettings.popupName == RMQSFUM_1ByPopup )
		settingIdName = 'RMQSFUM_1';
	else if( globalSettings.popupName == RMQSMGM_1ByPopup )
		settingIdName = 'RMQSMGM_1';
	else if( globalSettings.popupName == RMQSMGM_2ByPopup )
		settingIdName = 'RMQSMGM_2';
	else if( globalSettings.popupName == RMQSOUM_1ByPopup )
		settingIdName = 'RMQSOUM_1';
	else if( globalSettings.popupName == RMQSR1D_1ByPopup )
		settingIdName = 'RMQSR1D_1';
	else if( globalSettings.popupName == RMQSR2D_1ByPopup )
		settingIdName = 'RMQSR2D_1';
	else if( globalSettings.popupName == RMQSR7D_1ByPopup )
		settingIdName = 'RMQSR7D_1';
	else if( globalSettings.popupName == RMQSRMM_1ByPopup )
		settingIdName = 'RMQSRMM_1';
	else if( globalSettings.popupName == RMQSRNM_1ByPopup )
		settingIdName = 'RMQSRNM_1';
	else if( globalSettings.popupName == RMQSRNM_2ByPopup )
		settingIdName = 'RMQSRNM_2';
	else if( globalSettings.popupName == RMQSUNM_1ByPopup || globalSettings.popupName == RMQSUNM_2ByPopup)
		settingIdName = 'RMQSUNM_1';
	else if( globalSettings.popupName == RMQSWCM_1ByPopup )
		settingIdName = 'RMQSWCM_1';
	else if( globalSettings.popupName == RMQSYCD_1ByPopup || globalSettings.popupName ==  RMQSYCD_2ByPopup )
		settingIdName = 'RMQSYCD_1';
	else if( globalSettings.popupName == RMQSYCD_3ByPopup )
		settingIdName = 'RMQSYCD_2';
	else if( globalSettings.popupName == RMQSYCD_4ByPopup || globalSettings.popupName == RMQSYCD_5ByPopup)
		settingIdName = 'RMQSYCD_4'; 
	else if( globalSettings.popupName == RMQSZLM_1ByPopup )
		settingIdName = 'RMQSZLM_1';
	else if( globalSettings.popupName == RMQUNTM_1ByPopup )
		settingIdName = 'RMQUNTM_1';
	else if( globalSettings.popupName == SCKNDMM_1ByPopup )
		settingIdName = 'SCKNDMM_1';
	else if( globalSettings.popupName == V02A_1ByPopup )
		settingIdName = 'V02A_1';
	else if( globalSettings.popupName == VW_GCVIEW1_1ByPopup )
		settingIdName = 'VW_GCVIEW1_1';
	else if( globalSettings.popupName == VW_ORG_4RJ_1ByPopup )
		settingIdName = 'VW_ORG_4RJ_1';
	else if( globalSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup )
		settingIdName = 'VW_ORG_4RJ_OLD_1';
	else if( globalSettings.popupName == VW_PERSON_LIST_1ByPopup )
		settingIdName = 'VW_PERSON_LIST_1';
	else if( globalSettings.popupName == VW_RMQSR6D_1ByPopup )
		settingIdName = 'VW_RMQSR6D_1';
	else if( globalSettings.popupName == WFCODNM_1ByPopup )
		settingIdName = 'WFCODNM_1';
	else if( globalSettings.popupName == WFORGNM_1ByPopup )
		settingIdName = 'WFORGNM_1';
	else if( globalSettings.popupName == NFSSTOM_1ByPopup )
		settingIdName = 'NFSSTOM_1';
	else if( globalSettings.popupName == SAAB_APPLICATION_1ByPopup )
		settingIdName = 'SAAB_APPLICATION_1';
	else if( globalSettings.popupName == SAAB_PRIVILEGE_DATA_1ByPopup )
		settingIdName = 'SAAB_PRIVILEGE_DATA_1';
	else if( globalSettings.popupName == SAAB_PRIVILEGE_DATA_2ByPopup )
		settingIdName = 'SAAB_PRIVILEGE_DATA_2';
	else if( globalSettings.popupName == SAAB_ORG_DATA_1ByPopup )
		settingIdName = 'SAAB_ORG_DATA_1';
	else if( globalSettings.popupName == SAAB_USER_DATA_1ByPopup )
		settingIdName = 'SAAB_USER_DATA_1';
	
	if( settingIdName == null)
		alert( 'Can not find any getSettingIdName in getSettingIdName() function, when popupName:' + globalSettings.popupName );
	return settingIdName + '_common';
}

function getStrWhere(){
	var sqlWhere = null;
	var strWhereEle = globalSettings.strWhereEle;
	var popupName = globalSettings.popupName; 
	
	if( 
		popupName == CSBSCOM_1ByPopup ||		
		popupName == RMQSRMM_1ByPopup ||
		popupName == RMQSRNM_1ByPopup || 
		popupName == RMQSRNM_2ByPopup  
		){
		
		var url = getContextPath() + '/common!getMainCustCdByCase1';
		
		$.ajaxSetup({async:false});
		$.post( url, function( callback ){			
			$.ajaxSetup({async:true});
			
			if( globalSettings.debug )
				alert( 'in getStrWhere(), callback data:' + JSON.stringify( callback.data ) );
			
			sqlWhere =  callback.data.MAIN_CUST_CD;
		});
	}else if( 
			
			 popupName == RMQSOUM_1ByPopup ||		
			 popupName == RMQUNTM_1ByPopup ||
			 popupName == RMQSUNM_2ByPopup ||
			 popupName == RMQSFUM_1ByPopup){ 
		var url = getContextPath() + '/common!getMainCustCd';
		
		$.ajaxSetup({async:false});
		$.post( url, function( callback ){			
			$.ajaxSetup({async:true});
			
			if( globalSettings.debug )
				alert( 'in getStrWhere(), callback data:' + JSON.stringify( callback.data ) );
			
			if( popupName == RMQSOUM_1ByPopup ){
				sqlWhere = getValueByMainCustCd( callback.data.MAIN_CUST_CD ); 
				strWhereEle = null;
			}
				
			
			//根據user關別篩選資料,但I關,會使用strWhereEle
			else if( popupName == RMQSUNM_2ByPopup || popupName == RMQSFUM_1ByPopup ){
 	
				sqlWhere =  callback.data.MAIN_CUST_CD;  
			    if(sqlWhere == "I"){
			    	sqlWhere = strWhereEle.val();
			    }
			    strWhereEle = null;
			}
			
			else{ 	
				sqlWhere =  callback.data.MAIN_CUST_CD;
			}
		});
	//需要指定 strWhereEle
	}else if( popupName == VW_RMQSR6D_1ByPopup  ){
		if( strWhereEle == null )
			alert( '未指定 strWhereEle' );
	}else if( popupName == RMQPGDM_2ByPopup ){
		sqlWhere = '2'; 
	}else if( popupName == RMQSYCD_1ByPopup ){
		sqlWhere = '030A';
	}else if( popupName == CSAEXZM_1ByPopup ){
		sqlWhere = 'Y';
	}else if( popupName == CSABNKM_1ByPopup ){
		sqlWhere = ' ';
	}else if( popupName == RMQSYCD_4ByPopup ){
		sqlWhere = 'RQ0J01';
	}else if( popupName == RMQSYCD_5ByPopup ){
		sqlWhere = 'RQ0J02';
	}else if( popupName == RMPUSRM_1ByPopup ){
		sqlWhere = strWhereEle.val().substring(0,1);
		strWhereEle = null;
	}       
	if( strWhereEle != null ){
		if( strWhereEle.length == 0 )
			alert( '指定的 strWhereEle selector 不存在 ' ); 
		
		sqlWhere = strWhereEle.val();
		
		if( popupName == CSACTQM_1ByPopup || popupName == CSACTQM_2ByPopup){
			sqlWhere = parseInt(sqlWhere)+1911;
		}
	} 
	return sqlWhere;
}

function popupTitleSetting( newSettings ){
	if(newSettings.popupTitle == 'PopupTitle'){
		
		if( globalSettings.popupName == CSABNKM_1ByPopup )
			newSettings.popupTitle = '金融機構檔_總行代號視窗';
		else if( globalSettings.popupName == CSABNKM_2ByPopup )
			newSettings.popupTitle = '金融機構檔_分行代號視窗';
		else if( globalSettings.popupName == CSACODM_1ByPopup )
			newSettings.popupTitle = '代碼檔視窗';
		else if( globalSettings.popupName == CSACODM_2ByPopup )
			newSettings.popupTitle = '代碼檔視窗';
		else if( globalSettings.popupName == CSACODM_3ByPopup )
			newSettings.popupTitle = '代碼檔視窗';
		else if( globalSettings.popupName == CSACOMM_1ByPopup )
			newSettings.popupTitle = '代碼類別檔視窗';
		else if( globalSettings.popupName == CSACTQM_1ByPopup )
			newSettings.popupTitle = '關稅配額稅則定義檔視窗';
		else if( globalSettings.popupName == CSACTQM_2ByPopup )
			newSettings.popupTitle = '關稅配額稅則定義檔視窗';
		else if( globalSettings.popupName == CSAEXZM_1ByPopup )
			newSettings.popupTitle = '查驗區檔視窗';
		else if( globalSettings.popupName == CSAESZM_1ByPopup )
			newSettings.popupTitle = '卸存區域代碼檔視窗';
		else if( globalSettings.popupName == CSAWARM_1ByPopup )
			newSettings.popupTitle = '卸存地檔視窗';
		else if( globalSettings.popupName == CSBCOMM_1ByPopup )
			newSettings.popupTitle = '廠商檔視窗';
		else if( globalSettings.popupName == CSBSCOM_1ByPopup )
			newSettings.popupTitle = '船公司(代理行)';
		else if( globalSettings.popupName == CSECRCM_1ByPopup )
			newSettings.popupTitle = '監理站視窗';
		else if( globalSettings.popupName == CSECTYM_1ByPopup )
			newSettings.popupTitle = '行政執行處視窗';
		else if( globalSettings.popupName == CSBEXPM_1ByPopup )
			newSettings.popupTitle = '快遞業者檔視窗';
		else if( globalSettings.popupName == CSEEMPM_1ByPopup )
			newSettings.popupTitle = '法務室承辦人員檔視窗';
		else if( globalSettings.popupName == CSEORGM_1ByPopup )
			newSettings.popupTitle = '行政執行機關檔視窗';
		else if( globalSettings.popupName == CSETOWM_1ByPopup )
			newSettings.popupTitle = '地政事務所視窗';
		else if( globalSettings.popupName == CSETOWM_2ByPopup )
			newSettings.popupTitle = '地政事務所視窗';
		else if( globalSettings.popupName == CSETXNM_1ByPopup )
			newSettings.popupTitle = '稅款代碼檔視窗';
		else if( globalSettings.popupName == CSEUNTM_1ByPopup )
			newSettings.popupTitle = '移案單位代碼檔視窗';
		else if( globalSettings.popupName == RMJTRKM_1ByPopup )
			newSettings.popupTitle = '註冊號數視窗';
		else if( globalSettings.popupName == RMJX10M_1ByPopup )
			newSettings.popupTitle = '舊違規貨品種類代碼參考表';
		else if( globalSettings.popupName == RMLX05M_1ByPopup )
			newSettings.popupTitle = '高風險廠商類別檔視窗';
		else if( globalSettings.popupName == RMLZ01M_1ByPopup )
			newSettings.popupTitle = '查詢項目代碼檔';
		else if( globalSettings.popupName == RMPUSRM_1ByPopup )
			newSettings.popupTitle = '稽核人員代碼查詢視窗';
		else if( globalSettings.popupName == RMQACCM_1ByPopup )
			newSettings.popupTitle = '帳目代號檔視窗';
		else if( globalSettings.popupName == RMQCASM_1ByPopup )
			newSettings.popupTitle = '案由檔視窗';
		else if( globalSettings.popupName == RMQCHGM_1ByPopup )
			newSettings.popupTitle = '欠繳類別代碼資料查詢';
		else if( globalSettings.popupName == RMQJOBM_1ByPopup )
			newSettings.popupTitle = '緝案組工作項目檔視窗';
		else if( globalSettings.popupName == RMQLAWM_1ByPopup )
			newSettings.popupTitle = '法令代碼檔視窗';
		else if( globalSettings.popupName == RMQLIMM_1ByPopup )
			newSettings.popupTitle = '私貨處理限制條件查詢視窗';
		else if( globalSettings.popupName == RMQPBRM_1ByPopup )
			newSettings.popupTitle = '安康專案菸類牌名檔視窗';
		else if( globalSettings.popupName == RMQPGDM_1ByPopup || globalSettings.popupName == RMQPGDM_2ByPopup)
			newSettings.popupTitle = '安康專案查緝走私產品類別檔視窗'; 
		else if( globalSettings.popupName == RMQSFUM_1ByPopup )
			newSettings.popupTitle = '一級單位代碼檔視窗';
		else if( globalSettings.popupName == RMQSMGM_1ByPopup )
			newSettings.popupTitle = '私貨代碼檔視窗';
		else if( globalSettings.popupName == RMQSMGM_2ByPopup )
			newSettings.popupTitle = '私貨代碼檔視窗';
		else if( globalSettings.popupName == RMQSOUM_1ByPopup )
			newSettings.popupTitle = '緝案處理單位檔視窗';
		else if( globalSettings.popupName == RMQSR1D_1ByPopup )
			newSettings.popupTitle = '身分證或廠商統編';
		else if( globalSettings.popupName == RMQSR2D_1ByPopup )
			newSettings.popupTitle = '速查視窗';
		else if( globalSettings.popupName == RMQSR7D_1ByPopup )
			newSettings.popupTitle = '出力人員檔視窗';
		else if( globalSettings.popupName == RMQSRMM_1ByPopup )
			newSettings.popupTitle = '緝私報告主檔視窗';
		else if( globalSettings.popupName == RMQSRNM_1ByPopup )
			newSettings.popupTitle = '緝獲單位編號字碼檔視窗';
		else if( globalSettings.popupName == RMQSRNM_2ByPopup )
			newSettings.popupTitle = '緝獲單位編號字碼檔視窗';
		else if( globalSettings.popupName == RMQSUNM_1ByPopup || globalSettings.popupName == RMQSUNM_2ByPopup)
			newSettings.popupTitle = '緝獲單位代碼檔視窗';
		else if( globalSettings.popupName == RMQSWCM_1ByPopup )
			newSettings.popupTitle = '走私方式檔視窗';
		else if( globalSettings.popupName == RMQSYCD_1ByPopup || globalSettings.popupName ==  RMQSYCD_2ByPopup )
			newSettings.popupTitle = '查緝系統代碼檔視窗';
		else if( globalSettings.popupName == RMQSYCD_3ByPopup )
			newSettings.popupTitle = '查緝系統代碼檔視窗';
		else if( globalSettings.popupName == RMQSYCD_4ByPopup )
			newSettings.popupTitle = '私貨處理_放行通知單格式視窗';
		else if( globalSettings.popupName == RMQSYCD_5ByPopup )
			newSettings.popupTitle = '私貨處理_銷毀清單(文號)格式視窗';
		else if( globalSettings.popupName == RMQSZLM_1ByPopup )
			newSettings.popupTitle = '緝獲地點代碼檔視窗';
		else if( globalSettings.popupName == RMQUNTM_1ByPopup )
			newSettings.popupTitle = '各級單位速查視窗';
		else if( globalSettings.popupName == SCKNDMM_1ByPopup )
			newSettings.popupTitle = '代碼種類檔視窗';
		else if( globalSettings.popupName == V02A_1ByPopup )
			newSettings.popupTitle = '員工查詢視窗';
		else if( globalSettings.popupName == VW_GCVIEW1_1ByPopup )
			newSettings.popupTitle = '違規整合作業之部門清單視窗';
		else if( globalSettings.popupName == VW_ORG_4RJ_1ByPopup || globalSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup )
			newSettings.popupTitle = '單位代碼查詢視窗';
		else if( globalSettings.popupName == VW_PERSON_LIST_1ByPopup )
			newSettings.popupTitle = '海關關員查詢窗視窗';
		else if( globalSettings.popupName == VW_RMQSR6D_1ByPopup )
			newSettings.popupTitle = '法令受處分人資料檔視窗';
		else if( globalSettings.popupName == WFCODNM_1ByPopup )
			newSettings.popupTitle = '簡易申辦代碼資料視窗';
		else if( globalSettings.popupName == WFORGNM_1ByPopup )
			newSettings.popupTitle = '表單組織資料視窗';
		else if( globalSettings.popupName == NFSSTOM_1ByPopup )
			newSettings.popupTitle = '國際免稅商店業者視窗';
		else if( globalSettings.popupName == SAAB_USER_DATA_1ByPopup )
			newSettings.popupTitle = '使用者資料速查視窗';
		else if( globalSettings.popupName == SAAB_APPLICATION_1ByPopup )
			newSettings.popupTitle = '應用系統代碼速查視窗';
		else if( globalSettings.popupName == SAAB_PRIVILEGE_DATA_1ByPopup || globalSettings.popupName == SAAB_PRIVILEGE_DATA_2ByPopup)
			newSettings.popupTitle = '稽核項目速查視窗';
		else if( globalSettings.popupName == SAAB_ORG_DATA_1ByPopup )
			newSettings.popupTitle = '部門單位查詢視窗';
	}
}

function popUpCallBack( data ){
	if( globalSettings.debug ){
		alert( 'in the popUpCallBack, popupName:' + globalSettings.popupName );
		
		if( globalSettings.codeEle != null && globalSettings.codeEle.length != 0 )
			alert( 'codeEle:' + globalSettings.codeEle.outerHtml() );
		else
			alert( 'codeEle:' + globalSettings.codeEle );
		
		if( globalSettings.nameEle != null && globalSettings.nameEle.length != 0 )
			alert( 'nameEle:' + globalSettings.nameEle.outerHtml() );
		else
			alert( 'nameEle:' + globalSettings.nameEle );		
		
		alert( 'callback data:' + JSON.stringify( data ) );
	}
	
	var codeByPopup = null;
	var nameByPopup = null;
	
	if( globalSettings.popupName == CSABNKM_1ByPopup ){
		codeByPopup = data.BANK_ID;
		nameByPopup = data.NAME;
	}
	else if( globalSettings.popupName == CSABNKM_2ByPopup ){
		codeByPopup = data.SUB_ID;
		nameByPopup = data.NAME;
	}
	else if( globalSettings.popupName == CSACODM_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.CODE_CHINESE;
	}
	else if( globalSettings.popupName == CSACODM_2ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.CODE_CHINESE;
	}
	else if( globalSettings.popupName == CSACODM_3ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.CODE_CHINESE;
	}
	else if( globalSettings.popupName == CSACOMM_1ByPopup ){
		codeByPopup = data.CODE_KIND;
		nameByPopup = data.CODE_NAME;
	}
	else if( globalSettings.popupName == CSACTQM_1ByPopup ){
		codeByPopup = data.DIS_QTY_NO;
	}
	else if( globalSettings.popupName == CSACTQM_2ByPopup ){
		codeByPopup = data.DIS_PRICE_NO;
	}
	else if( globalSettings.popupName == CSAEXZM_1ByPopup ){
		codeByPopup = data.EXAM_ZONE;
		nameByPopup = data.EXAM_NAME;
	}
	else if( globalSettings.popupName == CSAESZM_1ByPopup ){
		codeByPopup = data.WARE_REG;
		nameByPopup = data.WARE_REG_NAME;
	}
	else if( globalSettings.popupName == CSAWARM_1ByPopup ){
		codeByPopup = data.STOR_WARE_CD;
		nameByPopup = data.WARE_NAME;
	}
	else if( globalSettings.popupName == CSBCOMM_1ByPopup ){
		codeByPopup = data.BAN;
		nameByPopup = data.CNAME;
	}
	else if( globalSettings.popupName == CSBSCOM_1ByPopup ){
		codeByPopup = data.SHIP_CO_CD;
		nameByPopup = data.SHIP_COMP_NAME;
	}
	else if( globalSettings.popupName == CSECRCM_1ByPopup ){
		codeByPopup = data.OFF_ID;
		nameByPopup = data.OFF_SID_NAME;
	}
	else if( globalSettings.popupName == CSECTYM_1ByPopup ){
		codeByPopup = data.CITY_NAME;
		nameByPopup = data.ORGAN_NAME;
	}
	else if( globalSettings.popupName == CSBEXPM_1ByPopup ){
		codeByPopup = data.EXPRESS_CARRIER_BAN;
		nameByPopup = data.EXPRESS_CARRIER_NAME;
	}
	else if( globalSettings.popupName == CSEEMPM_1ByPopup ){
		codeByPopup = data.EMP_ID;
		nameByPopup = data.EMP_NAME;
	}
	else if( globalSettings.popupName == CSEORGM_1ByPopup ){
		codeByPopup = data.EXEORG_ID;
		nameByPopup = data.EXEORG_NAME;
	}
	else if( globalSettings.popupName == CSETOWM_1ByPopup ){
		codeByPopup = data.TOWN;
		nameByPopup = data.LANDOFFICE;
	}
	else if( globalSettings.popupName == CSETOWM_2ByPopup ){
		codeByPopup = data.TOWN;
		nameByPopup = data.BRANCH;
	}
	else if( globalSettings.popupName == CSETXNM_1ByPopup ){
		codeByPopup = data.TAX_ID;
		nameByPopup = data.TAX_NAME;
	}
	else if( globalSettings.popupName == CSEUNTM_1ByPopup ){
		codeByPopup = data.TRANSFER_UNIT;
		nameByPopup = data.UNIT_NAME;
	}
	else if( globalSettings.popupName == RMJTRKM_1ByPopup ){
		codeByPopup = data.REGISTRATIONNUMBER; 
	}
	else if( globalSettings.popupName == RMJX10M_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.ITEM;
	}
	else if( globalSettings.popupName == RMLX05M_1ByPopup ){
		codeByPopup = data.TYPE_CODE;
		nameByPopup = data.TYPE_NAME;
	}
	else if( globalSettings.popupName == RMLZ01M_1ByPopup ){
		codeByPopup = data.GC_PID;
		nameByPopup = data.GC_PNAME;
	}
	else if( globalSettings.popupName == RMPUSRM_1ByPopup ){
		codeByPopup = data.MAIN_ID;
		nameByPopup = data.MAIN_NAME;
	}
	else if( globalSettings.popupName == RMQACCM_1ByPopup ){
		codeByPopup = data.ACC_CD;
		nameByPopup = data.ACC_NAME;
	}
	else if( globalSettings.popupName == RMQCASM_1ByPopup ){
		codeByPopup = data.CASE_CD;
		nameByPopup = data.CASE_CONTENT;
	}
	else if( globalSettings.popupName == RMQCHGM_1ByPopup ){
		codeByPopup = data.CHG_ITEM_CD;
		nameByPopup = data.CHG_ITEM_NAME;
	}
	else if( globalSettings.popupName == RMQJOBM_1ByPopup ){
		nameByPopup = data.SZ_JOB_ITEM;
	}
	else if( globalSettings.popupName == RMQLAWM_1ByPopup ){
		codeByPopup = data.LAW_CD;
		nameByPopup = data.LAW_NAME;
	}
	else if( globalSettings.popupName == RMQLIMM_1ByPopup ){
		codeByPopup = data.LIM_ITM_CD;
		nameByPopup = data.LIM_ITM_DESC;
	}
	else if( globalSettings.popupName == RMQPBRM_1ByPopup ){
		codeByPopup = data.PBR_ITEM;
		nameByPopup = data.TOBACCO_BRAND;
	}
	else if( globalSettings.popupName == RMQPGDM_1ByPopup || globalSettings.popupName == RMQPGDM_2ByPopup){
		codeByPopup = data.PGD_CD;
		nameByPopup = data.PGD_NAME;
	}
	else if( globalSettings.popupName == RMQSFUM_1ByPopup ){
		codeByPopup = data.FSL_UNIT_CD;
		nameByPopup = data.FSL_UNIT_NAME;
	}
	else if( globalSettings.popupName == RMQSMGM_1ByPopup ){
		codeByPopup = data.SMUG_GOOD_CD;
		nameByPopup = data.SMUG_GOOD_CNAME;
	}
	else if( globalSettings.popupName == RMQSMGM_2ByPopup ){
		codeByPopup = data.CHN_UNIT;
		nameByPopup = data.ENG_UNIT;
	}	
	else if( globalSettings.popupName == RMQSOUM_1ByPopup ){
		codeByPopup = data.SZ_ORG_UNIT;
		nameByPopup = data.SZ_ORG_UNIT_NAME;
	}	
	else if( globalSettings.popupName == RMQSR1D_1ByPopup ){
		codeByPopup = data.SZ_PER_ID;
		nameByPopup = data.PER_CNAME;
	}	
	else if( globalSettings.popupName == RMQSR2D_1ByPopup ){
		codeByPopup = data.DECL_ITEM_NO; 
	}
	else if( globalSettings.popupName == RMQSR7D_1ByPopup ){
		codeByPopup = data.EMP_NO;
		nameByPopup = data.EMP_NAME;
	}
	else if( globalSettings.popupName == RMQSRMM_1ByPopup ){
		codeByPopup = data.SZ_RPT_NO;
		nameByPopup = data.SZ_BIG_NO;
	}
	else if( globalSettings.popupName == RMQSRNM_1ByPopup ){
		codeByPopup = data.CUST_CD;
		nameByPopup = data.SZ_RPT_NO_CD;
	}
	else if( globalSettings.popupName == RMQSRNM_2ByPopup ){
		codeByPopup = data.CUST_CD;
		nameByPopup = data.SZ_RPT_NO_CD;
	}
	else if( globalSettings.popupName == RMQSUNM_1ByPopup || globalSettings.popupName == RMQSUNM_2ByPopup){
		codeByPopup = data.SZ_UNIT_CD;
		nameByPopup = data.SZ_UNIT_NAME;
	} 
	else if( globalSettings.popupName == RMQSWCM_1ByPopup ){
		codeByPopup = data.SMUG_WAY_CD;
		nameByPopup = data.SMUG_WAY_DESC;
	}
	else if( globalSettings.popupName == RMQSYCD_1ByPopup || globalSettings.popupName == RMQSYCD_2ByPopup){
		codeByPopup = data.RQ_COD_DESC;
		nameByPopup = data.RQ_TEMP_1;
	}
	else if( globalSettings.popupName == RMQSYCD_3ByPopup ){
		codeByPopup = data.RQ_COD;
		nameByPopup = data.RQ_COD_DESC;
	}
	else if( globalSettings.popupName == RMQSYCD_4ByPopup || globalSettings.popupName == RMQSYCD_5ByPopup){
		codeByPopup = data.COD_DESC; 
	} 
	else if( globalSettings.popupName == RMQSZLM_1ByPopup ){
		codeByPopup = data.SZ_LOC_CD;
		nameByPopup = data.SZ_LOC_NAME;
	}
	else if( globalSettings.popupName == RMQUNTM_1ByPopup ){
		nameByPopup = data.UNIT_NAME;
	}
	else if( globalSettings.popupName == SCKNDMM_1ByPopup ){
		codeByPopup = data.CODE_KIND;
		nameByPopup = data.CODE_KIND_NEW;
	}
	else if( globalSettings.popupName == V02A_1ByPopup ){
		codeByPopup = data.V02AEMPID;
		nameByPopup = data.V02ANM;
	}
	else if( globalSettings.popupName == VW_GCVIEW1_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.NAME;
	}
	else if( globalSettings.popupName == VW_ORG_4RJ_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.NAME;
	}
	else if( globalSettings.popupName == VW_ORG_4RJ_OLD_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.NAME;
	}
	else if( globalSettings.popupName == VW_PERSON_LIST_1ByPopup ){
		codeByPopup = data.V02AEMPID;
		nameByPopup = data.V02ANM;
	}
	else if( globalSettings.popupName == VW_RMQSR6D_1ByPopup ){
		codeByPopup = data.SZ_PER_ID;
		nameByPopup = data.RMQSR1D_PER_CNAME;
	}
	else if( globalSettings.popupName == WFCODNM_1ByPopup ){
		codeByPopup = data.CODE;
		nameByPopup = data.CODE_DESC;
	}
	else if( globalSettings.popupName == WFORGNM_1ByPopup ){
		codeByPopup = data.DEPT_CODE;
		nameByPopup = data.DEPT_NAME;
	}
	else if( globalSettings.popupName == NFSSTOM_1ByPopup ){
		codeByPopup = data.STORE_CODE;
		nameByPopup = data.CNAME;
	}
	else if( globalSettings.popupName == SAAB_APPLICATION_1ByPopup ){
		codeByPopup = data.APP_ID;
		nameByPopup = data.C_NAME;
	}
	else if( globalSettings.popupName == SAAB_PRIVILEGE_DATA_1ByPopup || globalSettings.popupName == SAAB_PRIVILEGE_DATA_2ByPopup){
		codeByPopup = data.PRIVILEGE_ID;
		nameByPopup = data.C_NAME;
	}
	else if( globalSettings.popupName == SAAB_ORG_DATA_1ByPopup ){
		codeByPopup = data.ORG_ID;
		nameByPopup = data.C_NAME;
	}
	else if( globalSettings.popupName == SAAB_USER_DATA_1ByPopup ){
		codeByPopup = data.USER_ID;
		nameByPopup = data.USER_NAME;
	}
	else
		alert( 'Can not find any popupName in popUpCallBack() function, when popupName:' + globalSettings.popupName );
	
	if( globalSettings.codeEle != null && globalSettings.codeEle.length != 0 )
		globalSettings.codeEle.val( codeByPopup );
	
	if( globalSettings.nameEle != null && globalSettings.nameEle.length != 0 )
		globalSettings.nameEle.val( nameByPopup );
	
	if( globalSettings.dynamicCode != null )
		$( '#' + getPrefix( globalSettings.id, '_' ) + '_' + globalSettings.dynamicCode ).val( codeByPopup );
		
	if( globalSettings.dynamicName != null )
		$( '#' + getPrefix( globalSettings.id, '_' ) + '_' + globalSettings.dynamicName ).val( nameByPopup );
	
	globalSettings.callback( data );
	
	closeWindowByPopup( globalSettings.id );
}

function getValueByMainCustCd( custCd ){
	if( typeof( custCd ) != 'string' )
		alert( 'call getValueByMainCustCd() function, 指定的 custCd 不為 string type' );
	
	if( custCd == null || $.trim( custCd ).length == 0 )
		return custCd;
	
	if( custCd.toUpperCase() == 'A' )
		return '1';
	else if( custCd.toUpperCase() == 'B' )
		return '2';
	else if( custCd.toUpperCase() == 'C' )
		return '3';
	else if( custCd.toUpperCase() == 'D' )
		return '4';
	else
		return '';
}

function closeWindowByPopup( id ){
	$( '#bClose' ).trigger( 'click' );
}

/**
 * 開啟訊息小視窗( by msg )
 * 
 * @param msg 要顯示的訊息
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openSmallWindowByMsg( msg, allowedXClosed, popupTitle ){
	openWindowByMsg( 's', msg, allowedXClosed, popupTitle );
}

/**
 * 開啟訊息中視窗( by msg )
 * 
 * @param msg 要顯示的訊息
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openMediumWindowByMsg( msg, allowedXClosed, popupTitle ){
	openWindowByMsg( 'm', msg, allowedXClosed, popupTitle );
}

/**
 * 開啟訊息大視窗( by msg )
 * 
 * @param msg 要顯示的訊息
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openLargeWindowByMsg( msg, allowedXClosed, popupTitle ){
	openWindowByMsg( 'l', msg, allowedXClosed, popupTitle );
}

/**
 * 開啟小視窗( by msg )
 * 
 * @param url
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openSmallWindowByUrl( url, allowedXClosed, popupTitle ){
	openWindowByUrl( 's', url, allowedXClosed, popupTitle );
}

/**
 * 開啟中視窗( by msg )
 * 
 * @param url
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openMediumWindowByUrl( url, allowedXClosed, popupTitle ){
	openWindowByUrl( 'm', url, allowedXClosed, popupTitle );
}

/**
 * 開啟大視窗( by msg )
 * 
 * @param url
 * @param allowedXClosed 是否允許右上角關閉視窗(允許不用此參數)
 */
function openLargeWindowByUrl( url, allowedXClosed, popupTitle ){
	openWindowByUrl( 'l', url, allowedXClosed, popupTitle );
}

//======================= 以下為 private =======================
/**
 * @param imageType
 * @param msg
 * @param allowedXClosed 是否允許右上角關閉視窗, undefined 時為 true
 */
function openWindowByMsg( imageType, msg, allowedXClosed, popupTitle ){
	
	if( allowedXClosed == undefined )
		allowedXClosed = true;
	
	$( 'body' ).append( getPopupDivByMsg( imageType, msg, allowedXClosed, popupTitle ) );
	
	$( '#commonPopup' ).bPopup({
		modalClose	: false,
		onClose		: function(){ $( '#commonPopup' ).remove(); },
		iframeScroll: 'auto'
	});
}

/**
 * 
 * @param imageType
 * @param url
 * @param allowedXClosed 是否允許右上角關閉視窗, undefined 時為 true
 */
function openWindowByUrl( imageType, url, allowedXClosed, popupTitle ){
	
	if( allowedXClosed == undefined )
		allowedXClosed = true;
	
	$( 'body' ).append( getPopupDivByUrl( imageType, allowedXClosed, popupTitle ) );
	
	$( '#commonPopup' ).bPopup( {
		modalClose			: false,
		content				: 'iframe',
		contentContainer 	: '#popupContent',
		loadUrl				: url,
		onClose				: function(){ $( '#commonPopup' ).remove(); },
		iframeScroll		: 'auto'
	});
	
	var imageInfo = getImageInfo( imageType );
	
	var style = 'position:absolute; top:25px; left:15px; width:' + ( imageInfo.getWidth() - 30 ) + 'px; height:' + ( imageInfo.getHeight() - 42 ) + 'px; border:none;';
	
	$( 'iframe', $( '#commonPopup' ) ).attr( 'style', style );
}

/**
 * 
 * @param imageType
 * @param msg
 * @param allowedXClosed true: 含 "X", false: 不含 "X"
 * @returns
 */
function getPopupDivByMsg( imageType, msg, allowedXClosed, popupTitle ){
	var $div = getPopupDiv( imageType, allowedXClosed, popupTitle );
	$div.append( '<p>' + msg + '</p>' );
	
	return $div;
}

/**
 * 
 * @param imageType
 * @param allowedXClosed true: 含 "X", false: 不含 "X"
 * @returns
 */
function getPopupDivByUrl( imageType, allowedXClosed, popupTitle ){
	var $div = getPopupDiv( imageType, allowedXClosed, popupTitle );
	$div.append( '<div id="popupContent"></div>' );
	
	return $div;
}

/**
 * 依照 imageType( "s", "m", "l" ) 來取得到 $div, 當 allowedXClosed 為 true 時, 含 close "X", false 時, close "X" 會 hide()
 * 
 * @param imageType s: 小圖, m: 中圖, l: 大圖
 * @param allowedXClosed true: 含 "X", false: 不含 "X"
 * @returns
 */
function getPopupDiv( imageType, allowedXClosed, popupTitle ){
	var $closeEle = $( getCloseHtml() );
	var $titleEle = $( getTitleHtml( popupTitle ) );
	var $div = getDiv( imageType );
	$div.append( $closeEle  ).append( $titleEle );
	
	if( allowedXClosed )
		$closeEle.show();
	
	return $div; 
}

/**
 * 依照 imageType( "s", "m", "l" ) 來取得到 $div
 * 
 * @param imageType s: 小圖, m: 中圖, l: 大圖
 * @returns
 */
function getDiv( imageType ){
	var imageInfo = getImageInfo( imageType );
	
	return $( '<div id="commonPopup" style="background:url(' + getContextPath() + '/js/new/popup/' + imageInfo.getName() + ') no-repeat; display:none; padding:15px; width:' + ( imageInfo.getWidth()- 30 ) + 'px; height:' + ( imageInfo.getHeight() - 32 ) + 'px;"></div>' );
}

/**
 * 取得 右上角 X 的 html
 * @returns {String}
 */
function getCloseHtml(){	
	return '<a class="bClose" style="cursor:pointer; font-weight:bold; position:absolute; right:15px; text-decoration:none; top:5px; font-size: 20px; display:none;" id="bClose">X</a>';
}

/**
 * 取得 popup title
 * @returns {String}
 */
function getTitleHtml( popupTitle ){	
	return '<div style="width: 515px;font-weight:bold; position:absolute; left:15px; top:5px; display:inline; font-family: Microsoft JhengHei, Comic Sans MS; text-align: center; font-size: 17px; background-color: #eaeffc;" id="bTitle">' + popupTitle + '<div>';
}

function getImageInfo( imageType ){
	var imageInfo = new ImageInfo();
	
	if( imageType == 's' ){
		imageInfo.setName( 'bgSmall.png' );
		imageInfo.setWidth(242);
		imageInfo.setHeight(141);
	}
	else if( imageType == 'm' ){
		imageInfo.setName( 'bgMedium.png' );
		imageInfo.setWidth(560);
		imageInfo.setHeight(380);
	}
	else if( imageType == 'l' ){
		imageInfo.setName( 'bgLarge.png' );
		imageInfo.setWidth(800);
		imageInfo.setHeight(466);		
	}
	else{
		alert( 'The value of imageType is error, imageType:' + imageType );
		return imageInfo;
	}
	
	return imageInfo;
}

function ImageInfo( name, width, height ){
	this.name = name;
	this.width = width;
	this.height = height;
	
	this.setName = function( name ){ this.name = name; };
	this.setWidth = function( width ){ this.width = width; };
	this.setHeight = function( height ){ this.height = height; };
	
	this.getName = function(){ return this.name; };
	this.getWidth = function(){ return this.width; };
	this.getHeight = function(){ return this.height; };
}